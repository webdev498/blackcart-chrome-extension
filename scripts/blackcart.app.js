!function(){"use strict";window.BLACKCART_CONFIG={server:{baseURL:"https://blackcart.co:3000",endPoints:{auth:"/auth",getUserByID:"/user/",getOrder:"/order",getOrderByUser:"/order/byuser",addProduct:"/order/addproduct",removeProduct:"/order/removeproduct",createOrder:"/order",getToken:"/token",refreshToken:"/token/refresh",getBrands:"/brands",getUserInfo:"/user/info",saveShippingInfo:"/user/info/shipping",savePaymentInfo:"/user/info/payment",analytics:{showButton:"/analytics/showbutton"}}},uploadURL:"https://api.imgur.com/3/image",loginRedirectURL:"https://blackcart.co/register/walkthrough.php"}}(),function(){"use strict";var a={},b={};_.mixin({capitalize:function(a){return _.map(a.split(" "),function(a){return a.charAt(0).toUpperCase()+a.substring(1)}).join(" ")}}),window.Blackcart={globals:{},views:{},collections:{addCollection:function(b,c,d){return d=d||{},a[c]&&d.override||(a[c]=b),b},getCollectionInstance:function(c){var d;if(!c)throw new Error("collection name is required");return d=b[c],d?d:b[c]=new a[c]}}}}(),function(){"use strict";var a={},b="",c="",d=window.BLACKCART_CONFIG,e=800,f=1,g=function(a){var b={url:a.url,type:a.method,dataType:"json",cache:!1,processData:!1};return a.data&&(a.contentType||"GET"===a.method||(b.contentType="application/json"),"application/json"===b.contentType?b.data=JSON.stringify(a.data):b.data=a.data),$.ajax(b)},h=function(a){var b=window.BLACKCART_CONFIG.server.baseURL,c=a.endpoint;return a.url=b+(c.startsWith("/")?c:"/"+c),g(a)};window.Blackcart.utils={extendMany:function(){var a=Array.prototype.slice.call(arguments),b=a.shift();return _.reduce(a,function(a,b){return a.extend(b)},b)},createCustomViewClass:function(){return this.extendMany(Backbone.View,this.UtilsClass,this.TemplateLoader)},UtilsClass:{log:function(){var a=Array.prototype.slice.call(arguments);1===a.length?console.log("Blackcart:",a[0]):a.length>=2&&console[a[0]]&&console[a[0]]("Blackcart:",a[1])},getChromeURL:function(a){return chrome.extension.getURL(a)},ajax:g,rest:h,getShadowElement:function(a){var b=this.$el.get(0),c=b.shadowRoot;return c.querySelectorAll(a)}},TemplateLoader:{vendorCSS:["styles/vendor/font-awesome.min.css","bower_components/bootstrap/dist/css/bootstrap.min.css","bower_components/bootstrap/dist/css/bootstrap-theme.min.css"],loadTemplateFromURL:function(b){var c;return a[b]?a[b]:(c=$.get(this.getChromeURL(b)),c.done(function(c){a[b]=c}),c)},loadCSSFromURL:function(a){return'<style> @import "'+chrome.extension.getURL(a)+'"; </style>'},loadVendorCSS:function(){return _.map(this.vendorCSS,function(a){return'<style> @import "'+chrome.extension.getURL(a)+'"; </style>'}).join("\n")}},generateRandom:function(a){var b=Math.pow(10,a||5);return Math.round(Math.random()*b)},resetImgurToken:function(){return b=null,c=null,this},getImgurToken:function(){var a=d.server.baseURL+d.server.endPoints.getToken+"/imgur",e=$.Deferred();return b?e.resolve():($.ajax({url:a,type:"GET"}).done(function(a){b=a.access_token,c=a.refresh_token,e.resolve()}).fail(function(){e.reject()}),e)},refreshImgurToken:function(){var a=d.server.baseURL+d.server.endPoints.refreshToken+"/imgur";return $.ajax({url:a,type:"POST"})},getDataURI:function(a,b){chrome.runtime.sendMessage({evt:"get-dataurl",imgURL:a},function(a){b(a.dataURL)})},checkImageLoad:function(a,b){chrome.runtime.sendMessage({evt:"check-image-load",imgURL:a},function(a){b(a&&"check-image-load:ok"===a.resp)})},uploadImage:function(a,g,h){var i=this;return h=h||$.Deferred(),g=_.isUndefined(g)?0:g,a?(g||(a=a.replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),$.ajax({url:d.uploadURL,type:"POST",headers:{Authorization:"Bearer "+b,Accept:"application/json"},data:{image:a,type:"file"}}).done(function(a){h.resolve(a)}).fail(function(d){401===d.status||403===d.status?g>f?(i.resetImgurToken().refreshImgurToken(),h.reject("token-error")):(g+=1,i.resetImgurToken().refreshImgurToken().done(function(d){return d&&"IN-PROGRESS"===d.result?setTimeout(function(){i.getImgurToken().done(function(){return i.uploadImage(a,g,h)}).fail(function(){h.reject("token-error")})},e):d&&d.access_token?(b=d.access_token,c=d.refresh_token,i.uploadImage(a,g,h)):void h.reject("token-error")}).fail(function(){h.reject("token-error")})):504===d.status&&(i.UtilsClass.log("error","Gateway time out"),h.resolve({data:{}}))}),h):(h.reject("datauri-undefined"),h)},logShowButton:function(a,b){return h({endpoint:d.server.endPoints.analytics.showButton,data:{uid:a.UID,retailerName:b.PSource},method:"POST"})},fixThumbnailURL:function(a){return!a||a.indexOf("?")<0?a:a.split("?")[0]},uploadImageConditional:function(a){var b,c,d=this;return a&&a.startsWith("data:image")?a.startsWith("data:image/jpeg")||a.startsWith("data:image/png")?this.uploadImage(a):(b=$.Deferred(),this.getDataURI(a,function(a){d.uploadImage(a).done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)})}),b.promise()):(b=$.Deferred(),c=this.fixThumbnailURL(a),this.checkImageLoad(c,function(e){e?b.resolve(c):d.getDataURI(a,function(a){d.uploadImage(a).done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)})})}),b.promise())}}}(),function(){"use strict";var a={zaraCustomHandler:function(a){var b=this,c=1200,d=1500;window.onpopstate=function(){setTimeout(function(){b.removeButtons().injectButton(a)},c)},$("body").on("click","a",function(){var e=$(this);(e.parent().is("li.product")||e.parent().is("#products-nav"))&&setTimeout(function(){b.removeButtons().injectButton(a)},c),e.hasClass("_product-popup-link")&&setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup"})},d)}),$("body").on("click","span",function(){var c=$(this);c.hasClass("arrow")&&setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup"})},d)})},newBalanceCustomHandler:function(a){var b=this,c=1500;$("body").on("click","li.tile",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},shopBopCustomHandler:function(a){var b=this,c=1500;$("body").on("click","li.product",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},theShoeCompanyCustomHandler:function(a){var b=this,c=1500;$("body").on("click","a.productQuickViewLink",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)}),$("body").on("click","#quickviewLightbox .sizeSelector li",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)}),$("body").on("click","#quickviewLightbox .dk_options_inner li > a",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},americanEagleCustomHandler:function(a){var b=this,c=2e3;$("body").on("click",".aeoicon-add",function(){$(this).parent().hasClass("quickview-product-btn")&&setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)}),$("body").on("click",".quickview-product-btn",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)}),$("body").on("click",".quickview-swatch-img",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},billabongCustomHandler:function(a){var b=this,c=2e3;$("body").on("click","a.quickview",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},nikeCustomHandler:function(a){var b=this,c=800;$("body").on("click","li",function(){var d=$(this);d.parents(".color-chips").length>0&&setTimeout(function(){b.removeButtons().injectButton(a)},c)})},garageCustomHandler:function(a){var b=this,c=2e3;$("body").on("click","a.quickViewImg",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},footLockerCustomHandler:function(a){var b=this,c=1500;$("body").on("mousedown","a.quickviewButton",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},hollisterCustomHandler:function(a){var b=this,c=1500;$("body").on("click","a.grid-product__quick-view",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},jackjonesCustomHandler:function(a){var b=this,c=2e3;$("body").on("click","a.quick-view",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},marcianoCustomHandler:function(a){var b=this,c=2e3;$("body").on("mouseup","a.quickviewLink",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},melanieLyneCustomHandler:function(a){var b=this,c=5e3,d=1500;$("body").on("click",".quickview",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0,isIframe:!0})},c)}).on("click",".swatches li.selectable",function(){setTimeout(function(){b.removeButtons().injectButton(a,{stopPolling:!0})},d)})},underArmourCustomHandler:function(a){var b=this,c=5e3;$("body").on("click",".product-quickview",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0,isIframe:!0})},c)})},rwcoCustomHandler:function(a){var b=this,c=1500;$("body").on("click",".swatchanchor",function(){setTimeout(function(){b.removeButtons().injectButton(a)},c)}).on("click","a.btn-quickview",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},forever21Handler:function(a){var b=this,c=1500;$("body").on("click",".quick_view",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},brownShoesHandler:function(a){var b=this,c=1500,d=1800;$("body").on("click","#quickviewbutton",function(){setTimeout(function(){b.removeButtons().injectButton(a,{injectType:"popup",stopPolling:!0})},c)}).on("click",".swatchanchor,.swatches.Color .selected,.swatches.size .selected",function(){setTimeout(function(){b.removeButtons().injectButton(a,{stopPolling:!0})},d)})},runningRoomCustomHandler:function(a){var b=this,c=4e3;$("body").on("mouseup",".quickview-link",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0,isIframe:!0})},c)})},benchCustomHandler:function(a){var b=this,c=9e3;$("body").on("click",".quickview",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0,isIframe:!0})},c)})},simonsCustomHandler:function(a){var b=this,c=2e3;$("body").on("click","a.quick > span",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0})},c)})},theBayCustomHandler:function(a){var b=this,c=2e3;$("body").on("mouseup",".quickview",function(){setTimeout(function(){b.removeButtons("popup").injectButton(a,{injectType:"popup",stopPolling:!0,isIframe:!0})},c)})},joeFreshCustomHandler:function(a){var b=this,c=1500;$("body").on("change","#variant,#qty",function(){setTimeout(function(){b.removeButtons().injectButton(a,{stopPolling:!0})},c)}).on("click","li.active-result",function(){setTimeout(function(){b.removeButtons().injectButton(a,{stopPolling:!0})},c)})}};window.Blackcart.CustomHandlers=a}(),function(){"use strict";var a=window.Blackcart.utils,b=window.BLACKCART_CONFIG,c=a.extendMany(Backbone.Model,a.UtilsClass),d=a.extendMany(Backbone.Collection,a.UtilsClass).extend({url:window.BLACKCART_CONFIG.server.endPoints.getOrderByUser,model:c,initialize:function(){var a=this;this.on("add remove",function(){a.saveLocal()})},addProduct:function(c){var d,e=this;return d=$.Deferred(),a.uploadImageConditional(c.PThumbnail).done(function(a){a&&200===a.status&&(c.PThumbnail=a.data.link)}).fail(function(a){e.log("error",a)}).always(_.bind(function(){this.rest({endpoint:b.server.endPoints.addProduct,method:"POST",data:{uid:this.UID,oid:this.OID,product:c,orderNo:this.OrderNo}}).done(function(a){e.OID=a.OID,c.PID=a.PID,e.add(c,{at:0}),e.mergeWithRemote().done(function(a){a||e.trigger("cart-update")}).fail(function(a){e.log("error",a)}).always(function(){d.resolve()})}).fail(function(a){d.reject(a)})},this)),d},removeProduct:function(a){var c=this,d=this.get(a),e=$.Deferred();return this.rest({endpoint:b.server.endPoints.removeProduct,method:"POST",data:{oid:this.OID,pid:d.get("PID")}}).done(function(b){c.OID=b.OID,c.remove(a),c.mergeWithRemote().done(function(a){a||c.trigger("cart-update")}).fail(function(a){c.log("error",a)}).always(function(){e.resolve()})}).fail(function(b){return b&&410===b.status?(c.remove(a),e.resolve()):void e.reject(b)}),e},clearLocal:function(){var a=this.UID,b=$.Deferred();return chrome.storage.sync.get({blackcart_orders:!1},function(c){var d=c.blackcart_orders;d&&d[a]&&(d[a]=null,delete d[a]),chrome.storage.sync.set({blackcart_orders:d},function(){b.resolve()})}),b},saveLocal:function(){var a=this.UID,b=this,c=$.Deferred();return chrome.storage.sync.get({blackcart_orders:!1},function(d){var e=d.blackcart_orders;e||(e={}),e[a]={oid:b.OID,products:b.toJSON(),orderNo:b.OrderNo},chrome.storage.sync.set({blackcart_orders:e},function(){c.resolve()})}),c.promise()},queryLocal:function(a){var b,c=this.UID,d=this,e=$.Deferred();return chrome.storage.sync.get({blackcart_orders:!1},function(f){var g=f.blackcart_orders;return a&&a.OID&&a.OrderNo?(d.OrderNo=a.OrderNo,d.OID=a.OID,d.reset(_.map(a.products,function(a){return{PSource:a.PSource,PName:a.PName,PID:a.PID,PThumbnail:a.PThumbnail,Price:a.Price,PageURL:a.PageURL||"#",ScreenshotURL:a.ScreenshotURL||"#"}})),d.saveLocal().done(function(){e.resolve()}),!1):g&&g[c]?(b=g[c],d.OID=b.oid,d.OrderNo=b.orderNo,d.reset(b.products),void e.resolve()):(d.generateOrderNo(),d.reset([]),d.saveLocal().done(function(){e.resolve()}),!1)}),e.promise()},mergeWithRemote:function(){var a=$.Deferred(),c=this;return this.rest({endpoint:b.server.endPoints.getOrderByUser+"/"+this.UID,method:"GET"}).done(function(b){var d,e;return b?b.OID?(d=_.map(c.models,function(a){return a.get("PID")}),e=_.pluck(b.products,"PID"),_.difference(d,e).length||_.difference(e,d).length?void c.queryLocal(b).done(function(){a.resolve()}).fail(function(b){a.reject(b)}):a.resolve(!0)):(c.resetOrder(),void a.resolve()):a.reject(new Error("An error occurred."))}).fail(function(b){a.reject(b)}),a},setUID:function(a){return this.UID=a,this},generateOrderNo:function(){return this.OrderNo||(this.OrderNo=a.generateRandom(6)),this},getTotal:function(){var a;return this.reduce(function(b,c){return a=parseFloat(c.get("Price")||0),a=isNaN(a)?0:a,b+a},0).toFixed(2)},uploadThumbnails:function(b){var c=$.Deferred(),d=[],e=this;return _.each(b,function(b){var c=$.Deferred();b.PThumbnail&&(a.getDataURI(b.PThumbnail,function(d){a.uploadImage(d).done(function(a){b.PThumbnail=a.data.link&&a.data.link.replace("http://","https://")}).fail(function(){e.log("error","Failed to load image")}).always(function(){c.resolve()})}),d.push(c))}),$.when.apply(null,d).then(function(){c.resolve(b)}),c},sync:function(){var a,c,d=this;return this.UID?(a=$.Deferred(),c=this.toJSON(),d.rest({endpoint:b.server.endPoints.createOrder,method:"POST",data:{uid:d.UID,oid:d.OID,products:c,orderSize:d.getTotal(),orderNo:d.OrderNo}}).done(function(){a.resolve()}).fail(function(b){a.reject(b)}),a):this.log("error","UID is not defined")},query:function(){var a=this;return this.UID?void this.rest({endpoint:this.url+"/"+this.UID,method:"GET"}).done(function(b){b.OID&&(a.OID=b.OID,b.products.length&&a.reset(b.products))}).fail(function(b){a.log("error",b)}):this.log("error","UID is not defined")},resetOrder:function(){var a=this;return this.clearLocal().always(function(){a.OID=null,a.OrderNo=null,a.queryLocal().done(function(){a.trigger("cart-reset")})}),this}});window.Blackcart.collections.addCollection(d,"Order")}(),function(){"use strict";var a=window.Blackcart.utils,b=a.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/loading.html",cssURL:"styles/chromestyle.css",className:"hidden",initialize:function(){var a=this,b=this.loadTemplateFromURL(this.templateURL);_.isString(b)?(this.template=_.template(b),this.render().hide()):b.done(function(b){a.template=_.template(b),a.render().hide()}).fail(function(b){a.log("error",b)})},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/chromestyle.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)}}),this.position(),this},position:function(){return this.$el.css({left:window.innerWidth/2-this.$el.width()/2}),this},show:function(){return this.$el.removeClass("hidden"),this.position(),this},hide:function(){return this.$el.addClass("hidden"),this}});window.Blackcart.views.LoadingView=b}(),function(){"use strict";var a=window.Blackcart.utils,b=a.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/retailers.html",cssURL:"styles/chromestyle.css",className:"hidden",events:{click:"onClick"},initialize:function(a){var b=this,c=this.loadTemplateFromURL(this.templateURL);this.brands=a.brands,_.isString(c)?(this.template=_.template(c),this.render().hide()):c.done(function(a){b.template=_.template(a),b.render().hide()}).fail(function(a){b.log("error",a)}),_.bindAll(this,"_onBodyClick")},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/chromestyle.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)},brands:this.brands,_:_}),this.position(),this},position:function(){return this.$el.css({left:window.innerWidth/2-this.$el.width()/2}),this},show:function(){return this.$el.removeClass("hidden"),this.position(),setTimeout(_.bind(function(){this.listenToBody()},this),100),this},hide:function(){return this.stopListening().$el.addClass("hidden"),this},onClick:function(a){var b=a.originalEvent,c=b.path[0];"retailer_window_close_btn"===c.id&&this.hide()},_onBodyClick:function(a){$(a.target).is(this.$el)||this.hide()},listenToBody:function(){return $("body").on("click",this._onBodyClick),this},stopListening:function(){return $("body").off("click",this._onBodyClick),this}});window.Blackcart.views.RetailersView=b}(),function(){"use strict";var a=window.Blackcart,b=864e5,c=a.utils,d=c.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/blackcarticon.html",cssURL:"styles/chromestyle.css",events:{click:"onClick"},initialize:function(a){var b,c=this;b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render()):b.done(function(a){c.template=_.template(a),c.render()}).fail(function(a){c.log("error",a)}),this.$parentEl=a.$parentEl,this.icon=a.icon},render:function(){var a,c,d=this.$el.get(0),e=this;return a=d.shadowRoot?d.shadowRoot:d.createShadowRoot(),this.cssLoaded?(a.removeChild(a.querySelector(".chrome-widget")),a.appendChild($(this.template({chromeURL:function(a){return chrome.extension.getURL(a)}})).get(0))):(a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/chromestyle.css")+this.loadCSSFromURL("styles/main.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)}}),this.cssLoaded=!0),chrome.storage.sync.get({lastAnimationTime:!1},function(a){var c=a.lastAnimationTime;(!c||(new Date).getTime()-c>=b)&&(c=(new Date).getTime(),e.showSpinAnimation=!0,chrome.storage.sync.set({lastAnimationTime:c,showSpinAnimation:!0}),setTimeout(function(){e.animate()},1500))}),_.isUndefined(this.showSpinAnimation)&&chrome.storage.sync.get({showSpinAnimation:!1},function(a){e.showSpinAnimation=a.showSpinAnimation,e.showSpinAnimation&&e.animate()}),this.showSpinAnimation&&(c=(this.getShadowElement(".icon-switcher")||[])[0],c&&c.classList&&(c.classList.add("spin"),c.style.webkitAnimationPlayState="running"),this.showSpinAnimation=!1,chrome.storage.sync.set({showSpinAnimation:!1})),this},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},onClick:function(a){var b=a.originalEvent,c=b.path,d=$(c[0]);return d.length?void(("blackcart-icon-switcher-img"===d.attr("id")||"blackcart-icon-switcher"===d.attr("id"))&&(a.preventDefault(),this.$parentEl.trigger("blackcart.iconclick"))):!0},animate:function(){var a=(this.getShadowElement(".icon-switcher")||[])[0];a&&a.classList&&(a.classList.add("spin"),a.style.webkitAnimationPlayState="running"),this.showSpinAnimation=!1,chrome.storage.sync.set({showSpinAnimation:!1})}});window.Blackcart.views.Icon=d}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=b.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/cart.html",cssURL:"styles/chromestyle.css",events:{click:"onClick","blackcart.cart.blur":"onBlur"},initialize:function(a){var b,c=this;b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render().hide()):b.done(function(a){c.template=_.template(a),c.render().hide()}).fail(function(a){c.log("error",a)}),this.$parentEl=a.$parentEl,this.user=a.user,this.order=a.order,this.order.on("add remove cart-reset cart-update",function(){c.render()})},render:function(){var a,c=this.$el.get(0);return a=c.shadowRoot?c.shadowRoot:c.createShadowRoot(),this.cssLoaded?(a.removeChild(a.querySelector(".chrome-widget")),a.appendChild($(this.template({chromeURL:function(a){return chrome.extension.getURL(a)},fixThumbnailURL:b.fixThumbnailURL,order:this.order})).get(0))):(a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/chromestyle.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)},fixThumbnailURL:b.fixThumbnailURL,order:this.order}),this.cssLoaded=!0),this._bindShadowRootEvents(),this},_bindShadowRootEvents:function(){var a=this.getShadowElement(".chrome-widget"),b=this.$el;return a&&a[0]&&(a=a[0],a.addEventListener("focusout",function(a){var c;a.target&&"INPUT"===a.target.nodeName&&"text"===a.target.type&&(c=a.target,b.trigger("blackcart.cart.blur",{cid:c.dataset.modelId,elType:c.classList.contains("item-size")?"item-size":"item-style",value:c.value}))})),a=null,this},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},showLoader:function(){var a=$(this.getShadowElement(".cart-spinner")[0]);return a.removeClass("hidden"),this},hideLoader:function(){var a=$(this.getShadowElement(".cart-spinner")[0]);return a.addClass("hidden"),this},onClick:function(a){var b,c,d=a.originalEvent,e=d.path,f=$(e[0]),g=this;if(!f.length)return!0;if("a2-2"===f.attr("id")){if(a.preventDefault(),f.hasClass("disabled"))return!0;c=this.getShadowElement(".cont_tlo_body_page_adress"),c.length&&$.each(c,function(){var a=$(this),b=a.attr("id"),c=g.order.get(b.split("-")[1]),d=a.find(".item-style"),e=a.find(".item-size");c.set({PStyle:d.val()||"--",PSize:e.val()||"--"})}),this.$parentEl.trigger("blackcart.cart.checkout")}else if("a1-1"===f.attr("id")){if(a.preventDefault(),f.hasClass("disabled"))return!0;this.$parentEl.trigger("blackcart.showRetailers")}else f.parent().hasClass("cancel-item")?(a.preventDefault(),b=f.parents(".cont_tlo_body_page_adress"),this.$parentEl.trigger("blackcart.showLoader"),this.order.removeProduct(b.attr("data-model-id")).fail(function(){}).always(function(){g.$parentEl.trigger("blackcart.hideLoader")})):f.hasClass("item-style-link")?(a.preventDefault(),f.addClass("hidden").next().removeClass("hidden")):f.hasClass("item-size-link")?(a.preventDefault(),f.addClass("hidden").next().removeClass("hidden")):"minimize-cart"===f.attr("id")?(a.preventDefault(),this.$parentEl.trigger("blackcart.minimize")):f.hasClass("refresh-cart-btn")&&this.showLoader().order.mergeWithRemote().done(function(a){a||g.order.trigger("cart-update")}).fail(function(a){g.log("error",a)}).always(function(){g.hideLoader()})},onBlur:function(a,b){var c,d;return(c=b.cid||"")&&(d=this.order.get(c))?void("item-size"===b.elType?d.set({PSize:b.value||""}):"item-style"===b.elType&&d.set({PStyle:b.value||""})):!1}});window.Blackcart.views.Cart=c}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=window.BLACKCART_CONFIG,d=b.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/confirm.html",cssURL:"styles/chromestyle.css",events:{click:"onClick",submitSuccess:"onSubmitDone",submitFailure:"onSubmitDone"},initialize:function(a){var b,c=this;this.user=a.user,this.order=a.order,this.$parentEl=a.$parentEl,b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render().hide()):$.when(b,this.getUserInfo()).then(function(a){c.template=_.template(a[0]),c.render().hide()},function(a){c.log("error",a)}),this.order.on("add change remove cart-update",function(){c.render()}),$.validate({html:!0,addValidClassOnAll:!0,validateOnBlur:!1,showHelpOnFocus:!1,addSuggestions:!1}),$.formUtils.addValidator({name:"stripe_cc",validatorFunction:function(a){return $.payment.validateCardNumber(a)},errorMessage:"Please enter a valid credit card number.",errorMessageKey:"badCreditCardNumber"})},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),this.cssLoaded?(a.removeChild(a.querySelector(".chrome-widget")),a.appendChild($(this.template({chromeURL:function(a){return chrome.extension.getURL(a)},order:this.order,userInfo:this.userInfo||{}})).get(0))):(a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/chromestyle.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)},order:this.order,userInfo:this.userInfo||{}}),this.cssLoaded=!0),this},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},showLoader:function(){var a=$(this.getShadowElement(".confirm-spinner")[0]);return a.removeClass("hidden"),this},hideLoader:function(){var a=$(this.getShadowElement(".confirm-spinner")[0]);return a.addClass("hidden"),this},onClick:function(a){var b,d,e,f,g=a.originalEvent,h=g.path,i=$(h[0]),j=this;if(!i.length)return!0;if("edit-shipping-information"===i.attr("id"))a.preventDefault(),i.hasClass("disabled")||this.showShippingInfoForm();else if("edit-payment-information"===i.attr("id")||"add-payment-information"===i.attr("id"))a.preventDefault(),i.hasClass("disabled")||this.showPaymentInfoForm();else if("save-shipping-info"===i.attr("id")){if(a.preventDefault(),!i.hasClass("disabled")){if(e=$(this.getShadowElement("#edit-shipping-information")[0]),b=$(this.getShadowElement("#user-shipping-info-form")[0]),!b.isValid(null,null,!0))return!0;d=$(this.getShadowElement("#user-shipping-info-form")[0]).serializeArray(),d=_.reduce(d,function(a,b){return a[b.name]=b.value,a},{uid:this.user.UID}),this.showLoader().disableButtons(),this.rest({method:"POST",endpoint:c.server.endPoints.saveShippingInfo,data:d}).done(function(a){var b=j.userInfo;b=$.extend(b,a),j.renderShippingInfo(),j.hideShippingInfoForm()}).fail(function(a){j.log("error",a)}).always(function(){j.hideLoader().enableButtons()})}}else if("cancel-shipping-info"===i.attr("id"))a.preventDefault(),i.hasClass("disabled")||(this.enableButtons(),this.hideShippingInfoForm());else if("save-payment-info"===i.attr("id")){if(a.preventDefault(),!i.hasClass("disabled")){if(f=$(this.getShadowElement("#edit-payment-information")[0]),b=$(this.getShadowElement("#user-payment-info-form")[0]),!b.isValid())return!0;d=$(this.getShadowElement("#user-payment-info-form")[0]).serializeArray(),d=_.reduce(d,function(a,b){return a[b.name]=b.value,a},{uid:this.user.UID}),this.showLoader().disableButtons(),this.rest({method:"POST",endpoint:c.server.endPoints.savePaymentInfo,data:d}).done(function(a){var b=j.userInfo;b=$.extend(b,a),j.renderPaymentInfo(),j.hidePaymentInfoForm()}).fail(function(a){b.removeClass("has-success").addClass("has-error").find(".help-block.form-error").remove(),$("<span></span>").addClass("help-block form-error").text("There was an error processing this card.").appendTo(b),j.log("error",a)}).always(function(){j.hideLoader().enableButtons()})}}else"cancel-payment-info"===i.attr("id")?(a.preventDefault(),i.hasClass("disabled")||(this.enableButtons(),this.hidePaymentInfoForm())):"a1"===i.attr("id")?(i.hasClass("disabled")||this.$parentEl.trigger("blackcart.confirm.back"),a.preventDefault()):"a2"===i.attr("id")?(i.hasClass("disabled")||(this.disableButtons(),this.$parentEl.trigger("blackcart.confirm.checkout")),a.preventDefault()):"minimize-cart"===i.attr("id")?(a.preventDefault(),this.$parentEl.trigger("blackcart.minimize")):"blackcart-check-cc"===i.attr("id")&&(a.preventDefault(),j.getUserInfo().done(function(){j.render()}))},onSubmitDone:function(){return this.enableButtons()},getUserInfo:function(){var a=this.user.UID,b=this;return this.rest({endpoint:"user/"+a+"/info",method:"GET"}).done(function(a){b.userInfo=a}).fail(function(a){b.log("error",a)})},disableButtons:function(){var a=[].slice.call(this.getShadowElement(".buttons")),b=[].slice.call(this.getShadowElement(".btn-save-info")),c=[].slice.call(this.getShadowElement(".btn-cancel-info"));return a=a.concat(b,c),a.length&&$.each(a,function(){var a=$(this);return a.hasClass("no-cc")?!0:void a.addClass("disabled")}),this},enableButtons:function(){var a=[].slice.call(this.getShadowElement(".buttons")),b=[].slice.call(this.getShadowElement(".btn-save-info")),c=[].slice.call(this.getShadowElement(".btn-cancel-info"));return a=a.concat(b,c),a.length&&$.each(a,function(){var a=$(this);return a.hasClass("no-cc")?!0:void a.removeClass("disabled")}),this},showShippingInfoForm:function(){var a=$(this.getShadowElement("#user-shipping-info-form")[0]),b=this.userInfo;return $(this.getShadowElement("#edit-shipping-information")[0]).addClass("hidden"),$(this.getShadowElement(".user-shipping-info")[0]).addClass("hidden"),$(this.getShadowElement(".user-shipping-info-edit")[0]).removeClass("hidden"),a.find("input").each(function(){var a=$(this),c=a.attr("data-bind");c&&b[c]?a.val(b[c]):a.val("")}),this},hideShippingInfoForm:function(){return $(this.getShadowElement("#edit-shipping-information")[0]).removeClass("hidden"),$(this.getShadowElement(".user-shipping-info")[0]).removeClass("hidden"),$(this.getShadowElement(".user-shipping-info-edit")[0]).addClass("hidden"),this},showPaymentInfoForm:function(){var a,b=$(this.getShadowElement("#user-payment-info-form")[0]),c=this.userInfo;return $(this.getShadowElement("#edit-payment-information")[0]).addClass("hidden"),$(this.getShadowElement(".payment-info-wrapper")[0]).addClass("hidden"),a=this.getShadowElement(".payment-custcd")[0],a&&$(a).addClass("hidden"),$(this.getShadowElement(".user-payment-info-edit")[0]).removeClass("hidden"),b.find("input").each(function(){var a=$(this),b=a.attr("data-bind");b&&c[b]?a.val(c[b]):a.val("")}),this},hidePaymentInfoForm:function(){var a;return $(this.getShadowElement("#edit-payment-information")[0]).removeClass("hidden"),$(this.getShadowElement(".payment-info-wrapper")[0]).removeClass("hidden"),a=this.getShadowElement(".payment-custcd")[0],a&&$(a).removeClass("hidden"),$(this.getShadowElement(".user-payment-info-edit")[0]).addClass("hidden"),this},renderShippingInfo:function(){var a=$(this.getShadowElement(".user-shipping-info")[0]),b=this.userInfo;a.find("span").each(function(){var a=$(this),c=a.attr("data-fields");c&&a.text(_.reduce(c.split(" "),function(a,c){return b[c]&&(a=a+" "+b[c]),a},""))})},renderPaymentInfo:function(){var a,b=$(this.getShadowElement(".payment-custcd")[0]);b.length||(b=this._addPaymentInfo()),this.userInfo.CustCD&&(a=$(this.getShadowElement("#a2")[0]),b.text(this.userInfo.CustCD?"Credit Card: xxxx xxxx xxxx "+this.userInfo.CustCD:""),a.removeClass("disabled no-cc"))},_addPaymentInfo:function(){var a=$(this.getShadowElement(".payment-info-container")[0]);return a.find("h3").removeAttr("style"),a.find("i").removeClass("fa-times-circle").addClass("fa-check-circle").removeAttr("style"),
a.find(".payment-info-wrapper").remove(),$('<a href="#" target="_blank" id="edit-payment-information">edit</a>').insertAfter(a.find("h3")),$('<span class="span payment-custcd"></span>').insertAfter(a),a.next()}});window.Blackcart.views.Confirm=d}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=b.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/success.html",cssURL:"styles/chromestyle.css",events:{click:"onClick"},initialize:function(a){var b,c=this;b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render().hide()):b.done(function(a){c.template=_.template(a),c.render().hide()}).fail(function(a){c.log("error",a)}),this.$parentEl=a.$parentEl,this.user=a.user,this.order=a.order},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/chromestyle.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)},order:this.order}),this},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},onClick:function(a){var b=a.originalEvent,c=b.path,d=$(c[0]);return d.length?void("minimize-cart"===d.attr("id")&&(a.preventDefault(),this.$parentEl.trigger("blackcart.minimize"))):!0}});window.Blackcart.views.Success=c}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=function(){var a;return function(b){return a||(a=document.createElement("a")),a.href=b,a.href}}(),d=function(a){return a&&a.indexOf("|")>=0&&(a=a.split("|")[0]),a.replace(/[A-Z\$\n\s\t\:]/gi,"")},e=/\:attr\([\w\-]+\)/g,f=/\:nth\(\d+\)/g,g=/[\s\t\r\n]/g,h=b.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/cartbutton.html",cssURL:"styles/chromestyle.css",events:{click:"onClick"},initialize:function(a){var b,c=this;return this.user=a.user,this.order=a.order,this.injectType=a.injectType||"",b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render()):b.done(function(a){c.template=_.template(a),c.render()}).fail(function(a){c.log("error",a)}),this.retailer=a.retailer,a.isIframe?(this.$iframe=a.$iframe,this._getNodeFromString=this._createGetNodeFromString(this.$iframe)):this._getNodeFromString=this._createGetNodeFromString("popup"===this.injectType?this.retailer.alternates.popup.root:this.retailer.root),this.$parentEl=a.$parentEl,this},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/chromestyle.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)}}),this},_createGetNodeFromString:function(a){return _.isObject(a)?function(b,c){return a.contents().find(c)}:a?function(b,c){return b.parents(a).find(c)}:function(a,b){return $(b)}},_getImageURL:function(a,b){var d,e;if(this.retailer.isBG){if(d=a.css("background-image")||a.css("background"),d.indexOf("url(")<0)throw new Error("Could not extract image.");e=d.replace('url("',"").replace('")',"")}else e="background-image"===b||"background"===b?a.css(b).replace('url("',"").replace('")',""):b?a.attr(b):a.attr("src");return c(e)},_getAttributeFromNode:function(a,b){var c;return"text"===b?a.children().length>0?(c=a.contents().filter(function(){return 3===this.nodeType&&""!==this.nodeValue.replace(g,"")}),$(c[0]||c).text()):a.text():a.attr(b)},_processMetaInformationForSelector:function(a){var b=a.substr(0),c={idx:-1};return b.indexOf(":attr(")>=0&&(c.attr=a.split(":attr(")[1].replace(")","").replace(/\s+/g,""),b=b.replace(e,"")),b.indexOf(":nth(")>=0&&(c.idx=parseInt(b.split(":nth(")[1].replace(")","").replace(/\s+/g,""),10)-1,b=b.replace(f,"")),[b,c]},_processSelector:function(a){var b,c,d,e,f=this.$el,g=this;return a.indexOf("||")>=0?(c=a.split("||"),_.every(c,function(a){if(e=g._processMetaInformationForSelector(a),d=e[1].attr,b=g._getNodeFromString(f,e[0]),-1!==e[1].idx&&e[1].idx<b.length&&(b=$(b.get(e[1].idx))),b.length>0){if(b.is("img"))return!1;if(d&&b.attr(d))return!1;if(b.is(":visible")&&!b.is(":empty"))return!1}return!0})):(e=this._processMetaInformationForSelector(a),d=e[1].attr,b=g._getNodeFromString(f,e[0]),-1!==e[1].idx&&e[1].idx<b.length&&(b=$(b.get(e[1].idx)))),{$node:b.length>1?$(b.get(0)):b,attribute:d}},extractContentsFromPage:function(a){var b,c,e,f=this.retailer,g=("popup"===this.injectType?f.alternates.popup.content:f.content)||{},h={PSource:f.PSource},i=this;return h.ScreenshotURL=a,_.each(g,function(a,f){return b=i._processSelector(a),c=b.$node,e=b.attribute,"PThumbnail"===f?(h.PThumbnail=i._getImageURL(c,e),!0):"Price"===f?(h.Price=d(i._getAttributeFromNode(c,e||"text")||""),!0):"PSource"===f?(h.PSource=(i._getAttributeFromNode(c,e||"text")||"").replace(/[\n\r]/gi,""),!0):void(h[f]=_.capitalize(i._getAttributeFromNode(c,e||"text").replace(/[\n\r]/gi,"").replace(/\s{2,}/gi,"")))}),h.PageURL=window.location.href,h},captureTabAndUpload:function(){var a=$.Deferred(),c=this;return chrome.runtime.sendMessage({evt:"capture-tab"},function(d){c.$parentEl.trigger("blackcart.showLoader"),b.getImgurToken().done(function(){b.uploadImage(d.dataURL).done(function(b){a.resolve(b)}).fail(function(b){a.reject(b)})})}),a},onClick:function(a){var b=a.originalEvent,c=b.path[0],d=this;a.preventDefault(),("blackcart-add-anchor"===c.id||"blackcart-add-img"===c.id)&&this.captureTabAndUpload().done(function(a){a.data.link||d.log("error","Could not retrieve URL from Imgur"),d.order.addProduct(d.extractContentsFromPage(a.data.link||"")).fail(function(){}).always(function(){d.$parentEl.trigger("blackcart.hideLoader"),d.$parentEl.trigger("blackcart.button.showCart")})}).fail(function(a){d.$parentEl.trigger("blackcart.hideLoader"),d.log("error",a),"token-error"===a&&alert("There was an error. Please try again in a few minutes.")})},show:function(){this.$el.removeClass("hidden")},hide:function(){this.$el.addClass("hidden")},destroy:function(){return this.remove(),this}});window.Blackcart.views.ButtonView=h}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=b.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/walkthrough1.html",cssURL:"styles/chromestyle.css",events:{click:"onClick","blackcart.walkthrough_1.hide":"hide"},initialize:function(a){var b,c=this;b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render()):b.done(function(a){c.template=_.template(a),c.render()}).fail(function(a){c.log("error",a)}),this.$parentEl=a.$parentEl,this.retailer=a.retailer},_bindToBody:function(){return this},_unbindFromBody:function(){return this},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/modal.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)},order:this.order}),this},show:function(){var b=(this.retailer.PSource,this);return a.walkthrough_1Shown=!0,chrome.storage.sync.get({isWalkthrough_1Shown:!1},function(c){c&&!c.isWalkthrough_1Shown?(b._show(),chrome.storage.sync.set({isWalkthrough_1Shown:!0})):(a.walkthrough_1Shown=!1,b.$parentEl.trigger("blackcart.walkthrough_1.hide"))}),this},_show:function(){return this._bindToBody().$el.removeClass("hidden"),this.$parentEl.trigger("blackcart.walkthrough_1.show"),this},hide:function(){return a.walkthrough_1Shown=!1,this._unbindFromBody().$el.addClass("hidden"),this.$parentEl.trigger("blackcart.walkthrough_1.hide"),this},onClick:function(a){var b=a.originalEvent,c=b.path,d=$(c[0]);return d.length?void((d.hasClass("close-modal")||d.hasClass("continue")||"modal-overlay"===d.attr("id"))&&(a.preventDefault(),this.hide())):!0}});window.Blackcart.views.Walkthrough_1View=c}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=b.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/walkthrough2.html",cssURL:"styles/chromestyle.css",events:{click:"onClick"},initialize:function(a){var b,c=this;b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render()):b.done(function(a){c.template=_.template(a),c.render()}).fail(function(a){c.log("error",a)}),this.$parentEl=a.$parentEl,this.retailer=a.retailer,this.$parentEl.on("blackcart.walkthrough_1.hide",function(){c._waitForOtherModal&&c.show()})},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/modal.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)},order:this.order}),this},show:function(){var b=(this.retailer.PSource,this);return a.walkthrough_1Shown?void(this._waitForOtherModal=!0):(this._waitForOtherModal=!1,chrome.storage.sync.get({isWalkthrough_2Shown:!1},function(a){a&&!a.isWalkthrough_2Shown&&(b._show(),chrome.storage.sync.set({isWalkthrough_2Shown:!0}))}),this)},_show:function(){return this.$el.removeClass("hidden"),this.$parentEl.trigger("blackcart.walkthrough_2.show"),this},hide:function(){return this.$el.addClass("hidden"),this.$parentEl.trigger("blackcart.walkthrough_2.hide"),this},onClick:function(a){var b=a.originalEvent,c=b.path,d=$(c[0]);return d.length?void((d.hasClass("close-modal")||d.hasClass("continue")||"modal-overlay"===d.attr("id"))&&(a.preventDefault(),this.hide())):!0}});window.Blackcart.views.Walkthrough_2View=c}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=b.createCustomViewClass().extend({tagName:"div",templateURL:"scripts/templates/walkthrough3.html",cssURL:"styles/chromestyle.css",events:{click:"onClick","blackcart.walkthrough_1.hide":"hide"},initialize:function(a){var b,c=this;b=this.loadTemplateFromURL(this.templateURL),_.isString(b)?(this.template=_.template(b),this.render()):b.done(function(a){c.template=_.template(a),c.render()}).fail(function(a){c.log("error",a)}),this.$parentEl=a.$parentEl,this.retailer=a.retailer,$("body").on("click",".blackcart-cart",function(){c.hide()})},_bindToBody:function(){return this},_unbindFromBody:function(){return this},render:function(){var a,b=this.$el.get(0);return a=b.shadowRoot?b.shadowRoot:b.createShadowRoot(),a.innerHTML=this.loadVendorCSS()+this.loadCSSFromURL("styles/modal.css")+this.template({chromeURL:function(a){return chrome.extension.getURL(a)},order:this.order}),this},show:function(){var a=this;return chrome.storage.sync.get({isWalkthrough_3Shown:!1},function(b){b&&!b.isWalkthrough_3Shown&&(a._show(),chrome.storage.sync.set({isWalkthrough_3Shown:!0}))}),this},_show:function(){return this.$el.removeClass("hidden"),this},hide:function(){return this.$el.hasClass("hidden")||this.$el.addClass("hidden"),this},onClick:function(a){var b=a.originalEvent,c=b.path,d=$(c[0]);return d.length?void((d.hasClass("close-modal")||d.hasClass("continue")||"modal-overlay"===d.attr("id"))&&(a.preventDefault(),this.hide())):!0}});window.Blackcart.views.Walkthrough_3View=c}(),function(){"use strict";var a=window.Blackcart,b=a.utils,c=a.CustomHandlers,d=a.views.ButtonView,e=/http\:\/\/|https\:\/\/|www\./gi,f=window.BLACKCART_CONFIG,g=!1,h=a.collections,i=a.views.LoadingView,j=a.views.Icon,k=a.views.Cart,l=a.views.Confirm,m=a.views.Success,n=a.views.RetailersView,o=a.views.Walkthrough_1View,p=a.views.Walkthrough_2View,q=a.views.Walkthrough_3View,r=b.extendMany(Backbone.View,b.UtilsClass).extend({retailersConfigURL:"config/retailers.json",maxRetryAttempts:15,retryInterval:5e3,retryAttempt:0,activeTab:"",_options:{},tabs:["cart","confirm","success"],events:{"blackcart.button.showCart":"onShowCart","blackcart.showLoader":"showLoader","blackcart.hideLoader":"hideLoader","blackcart.showRetailers":"showRetailers","blackcart.cart.checkout":"onCartCheckout","blackcart.confirm.back":"onConfirmBack","blackcart.confirm.checkout":"onConfirmCheckout","blackcart.minimize":"hideTab","blackcart.iconclick":"onIconClick"},buttonViewList:[],initialize:function(){var a=this;this.$bootstrapped=this.bootstrap(),chrome.runtime.onMessage.addListener(function(b,c,d){return c.tab?!0:"blackcart-is-tab-active"===b.evt?(d({status:g}),!0):("blackcart-user-logged-in"===b.evt&&(a.$bootstrapped&&"resolved"===a.$bootstrapped.state()||(a.$bootstrapped=a.bootstrap()),d({farewell:"blackcart-user-logged-in:OK"})),"blackcart-click"===b.evt&&(a.showActiveTab(),d({farewell:"blackcart-click:OK"})),void("blackcart-update-collection"===b.evt&&(a.order.queryLocal().done(function(){a.cart.render()}),d({farewell:"blackcart-update-collection:OK"}))))})},set:function(a){var b=this._options;return _.each(a,function(a,c){b[c]=a}),this},get:function(a){var b=this._options;return b.hasOwnProperty(a)?b[a]:null},bootstrap:function(){var a,b=this;return this.getConfig().done(function(d,e,f,i){if(b.user=f,d.retailersList&&(d.retailersList.retailers||[]).length){if(b.set({retailers:d.retailersList.retailers,brands:d.brands}),a=b._lookupRetailerWithURL(),!a)return b.log("Could not retrieve retailer information from URL");g=!0,chrome.runtime.sendMessage({evt:"blackcart-site-supported"}),b.order=h.getCollectionInstance("Order"),b.order.setUID(b.user.UID).queryLocal(i),b.maxRetryAttempts=a.maxRetryAttempts||b.maxRetryAttempts,b.retryInterval=a.retryInterval||b.retryInterval,a.customHandler&&c[a.customHandler]&&(b.constructor.prototype.customHandler=function(){c[a.customHandler].apply(this,arguments)},b.customHandler(a)),b.injectCart(a),b._onSiteSupported(),a.delay?setTimeout(function(){b.injectButton(a)},a.delay):b.injectButton(a)}}).fail(function(a){"user-error"===a?b.log("error","Please log in first to continue."):b.log("error",a)})},getConfig:function(){var a=$.Deferred(),b=this;return chrome.runtime.sendMessage({evt:"blackcart-get-config"},function(c){if(!c||!c.status)return console.error("Error. Could not retrieve config information."),a.reject("config-error");if("OK"===c.status)b._getOrder(c.config[2]).done(function(b){a.resolve(c.config[0],c.config[1],c.config[2],b)}).fail(function(b){return a.reject(b)});else if("ERR"===c.status)return a.reject(c.err)}),a},_getOrder:function(a){var b=$.Deferred();return this.rest({endpoint:f.server.endPoints.getOrderByUser+"/"+a.UID,method:"GET"}).done(function(a){b.resolve(a)}).fail(function(a){b.reject(a)}),b},_createGetNodeFromString:function(a){return a?function(b){return a.contents().find(b)}:function(a){return $(a)}},_processSelector:function(a,b){var c,d,e,f,g=this;return _.every(a.indexOf("||")>=0?a.split("||"):[a],function(a){return c=null,d=!1,e=!1,f=!1,a.indexOf(":prepend")>=0&&(d=!0,a=a.replace(":prepend","")),a.indexOf(":insertafter")>=0&&(e=!0,a=a.replace(":insertafter","")),a.indexOf(":insertbefore")>=0&&(f=!0,a=a.replace(":insertbefore","")),c=g._getNodeFromString(a),c.length?!1:!0}),{$node:c,shouldPrepend:d,insertAfter:e,insertBefore:f}},_buttonExists:function(a){var b=this;return _.isArray(a)?_.find(a,function(a){return!!b._getNodeFromString(a).length}):!!b._getNodeFromString(a).length},_getButtonSelector:function(a,b){var c;return c="popup"===a.injectType?b.alternates.popup.button.selector:b.polymorphicOn?b[b.polymorphicOn+"List"]:b.button.selector},injectButton:function(a,c){var e,f,g,h,i,j,k,l,m,n=!1,o=!1,p=!1,q=this;if(c=c||{},m=!!c.isIframe,this.retryAttempt+=1,this.injectTimeoutID=0,!a.button&&!a.polymorphicOn)return this.log("Button does not exist on this page");if(c.stopPolling&&this.injectTimeoutID&&clearTimeout(this.injectTimeoutID),m&&(l=$(a.alternates.popup.iframeSelector)),this._getNodeFromString=this._createGetNodeFromString(l),f=this._getButtonSelector(c,a),k=this._buttonExists(f),!k)return this.retryAttempt<this.maxRetryAttempts?(i=_.bind(function(){this.injectButton(a,c)},this),this.injectTimeoutID=setTimeout(i,this.retryInterval),this.injectTimeoutID):this.log("Button does not exist on this page");a.polymorphicOn&&_.isString(k)&&_.each(a.defs[k],function(b,c){a[c]=b}),this.injectTimeoutID=0,g="popup"===c.injectType?this._processSelector(a.alternates.popup.button.insertionNode):this._processSelector(a.button.insertionNode),j=a.button.cls,h=g.$node,n=g.shouldPrepend,o=g.insertAfter,p=g.insertBefore,a.addToBody||!h.length?(this.log("Could not find insertion location. Inserting at the top of the page"),h=$("<div></div>").addClass("blackcart-btn-wrapper blackcart-btn-top").attr("id","blackcart-add-to-cart").appendTo("body"),e=new d({el:h.get(0),$parentEl:this.$el,retailer:a,user:this.user,brands:this.get("brands"),order:this.order,injectType:c.injectType,isIframe:m,$iframe:l||null}),j&&e.$el.addClass(j),$("<br/>").insertBefore(e.$el),q.buttonViewList.push(e),e=null):h.each(function(b){var f=$(this),g=$("<div></div>").addClass("blackcart-btn-wrapper").attr("id","blackcart-add-to-cart-"+b);n?g.prependTo(f):o?g.insertAfter(f):p?g.insertBefore(f):g.appendTo(f),e=new d({el:g.get(0),$parentEl:q.$el,retailer:a,user:q.user,brands:q.get("brands"),order:q.order,injectType:c.injectType,isIframe:!!c.isIframe,$iframe:l||null}),j&&e.$el.addClass(j),$("<br/>").insertBefore(e.$el),q.buttonViewList.push(e),e=null});try{b.logShowButton(this.user,a),this._onShowButton()}catch(a){console.log("Blackcart exception",a)}},removeButtons:function(a){var b=this.buttonViewList;return a=a||"all",this.retryAttempt=0,_.each(b.slice(),function(c,d){("all"===a||c.injectType===a)&&(c.destroy(),b.splice(d,1))}),this},injectCart:function(a){var b=a.prependToBody?"prependTo":"appendTo",c=a.PSource.toLowerCase().replace(/&/g,"").replace(/[\s\&]/g,"-");this.loadingView=new i({el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-loading-view blackcart-retailer-"+c)[b](this.$el)}),this.retailersView=new n({el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-retailers-view blackcart-retailer-"+c)[b](this.$el),brands:this.get("brands")}),this.icon=new j({$parentEl:this.$el,el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-icon-wrapper blackcart-retailer-"+c)[b](this.$el)}),this.icon.show(),this.cart=new k({$parentEl:this.$el,el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-cart blackcart-retailer-"+c)[b](this.$el),order:this.order,user:this.user}),this.confirm=new l({$parentEl:this.$el,el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-confirm blackcart-retailer-"+c)[b](this.$el),order:this.order,user:this.user}),this.confirm.hide(),this.success=new m({$parentEl:this.$el,el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-success blackcart-retailer-"+c)[b](this.$el),order:this.order,user:this.user}),this.success.hide(),this.walkthrough_1=new o({$parentEl:this.$el,el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-modal-wrapper blackcart-retailer-"+c)[b](this.$el),retailer:a}),this.walkthrough_1.hide(),this.walkthrough_2=new p({$parentEl:this.$el,el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-modal-wrapper blackcart-retailer-"+c)[b](this.$el),retailer:a}),this.walkthrough_2.hide(),this.walkthrough_3=new q({$parentEl:this.$el,el:$('<div class="blackcart-container-el"></div>').addClass("blackcart-modal-wrapper blackcart-walkthrough-3 blackcart-retailer-"+c)[b](this.$el),retailer:a}),this.walkthrough_3.hide()},_lookupRetailerWithURL:function(){var a,b=window.location.href.replace(e,""),c=this.get("retailers");return _.every(c,function(c){return c.useStartsWith?b.startsWith(c.url.replace(e,""))?(a=c,!1):!0:b.indexOf(c.url.replace(e,""))>=0?(a=c,!1):!0}),a},onCartCheckout:function(){return this.showTab("confirm"),this},onConfirmBack:function(){return this.showTab("cart"),this},onConfirmCheckout:function(){var a=this;return this.showLoader(),this.order.sync().done(function(){a.confirm.$el.trigger("submitSuccess"),a.confirm.hide(),a.success.render().show(),a.activeTab="success",a.order.resetOrder()}).fail(function(b){a.confirm.$el.trigger("submitFailure"),a.log("error","There was an error processing the order",b)}).always(function(){a.hideLoader()}),this},onIconClick:function(){this.showActiveTab()},onShowCart:function(){this.walkthrough_3.show(),this.showCart()},showLoader:function(){return this.loadingView.show(),this},hideLoader:function(){return this.loadingView.hide(),this},showRetailers:function(){return this.hideTab().retailersView.show(),this},showTab:function(a){return this.activeTab&&this[this.activeTab].hide(),this[a].show(),this.activeTab=a,this},hideTab:function(){return this[this.activeTab||"cart"].hide(),this},showActiveTab:function(){this.showTab("cart")},showCart:function(){return this.showTab("cart")},_onSiteSupported:function(){return this.walkthrough_1.show(),this.$el.trigger("blackcart-site-supported"),this},_onShowButton:function(){return this.walkthrough_2.show(),this.$el.trigger("blackcart-show-button"),this}});return new r({el:$('<div class="blackcart-page-manager"></div>').appendTo("body")})}();